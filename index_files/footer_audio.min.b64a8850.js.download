var crg={};function crg_download_confirm(e,t){var i=!0,a=Number(jQuery("span.ss-counter").text()),s=Number(jQuery("span.ss-counter-limit").text())-a;if(s>0&&e&&(i=confirm("You are about to download a sound that will count towards your limit.\n\nTo play a medium quality version of the sound, use the player on the left.\n\nSounds played this way won't count.\n\nDo you want to download?")),i){var r=jQuery(t).attr("dl");r&&(r=r.split("").reverse().join(""),location.href=r,i=!1)}return i||window.setTimeout(function(){crg_update_stats()},1e3),i}function crg_update_stats(){var e=jQuery(".ss-counter"),t=jQuery(".ss-counter-limit");e.length&&jQuery.ojooAjax({url:"/ajax/status",dataType:"json",success:function(i){i&&(e.text(i.count),t.text(i.max))}})}jQuery(document).ready(function(){crg.status_timer=window.setInterval(function(){crg_update_stats()},3e4)});var downloadOptions=Object.keys(storageHost).map(e=>{var t=storageHost[e];return t.index=e,t}).filter(e=>"subscribed"===e.perm).reverse();const wZip=(e,t)=>Object.entries(e).reduce((e,[i,a])=>`${e} ${a} ${t[i]||""}`,""),w=(e,...t)=>wZip(e,t).split(" ").filter(Boolean),webExt="html html web.json json css js php csv",fp={extWeMightEncounter:w`wav mp3 ${webExt} wave m4a flac aac ogg aiff wma aif mp3a`,isKnownExt:e=>fp.extWeMightEncounter.includes(e.toLowerCase()),basename:(e="")=>e.substring(e.lastIndexOf("/")+1),dirname:(e="")=>e.substring(0,e.lastIndexOf("/")),ext:e=>{const t=e.substring(e.lastIndexOf(".")+1);return fp.isKnownExt(t)?t:""},useExt:(e,t)=>`${fp.stripExt(e)}.${t}`,stripExt:(e="")=>{const t=e.substring(e.lastIndexOf(".")+1);return fp.isKnownExt(t)?e.substring(0,e.lastIndexOf(".")):e},urlize:(e,t="-")=>e.trim().replaceAll(/[^a-z0-9 _./-]/gi,t),readNid:e=>fp.basename(e).split("-")[0]},logg=e=>{const t=[];return Object.entries(e).reduce((e,t)=>(e.push(...t),e),t),t.length?(console.log(...t),t[1]):null},urlFor=(e,t="")=>{const i={nid:t||fp.readNid(e),filePath:e,dirName:fp.dirname(e),nameStripExt:fp.stripExt(fp.basename(e)),urlEncode:encodeURIComponent(e),cleanFileName:fp.urlize(fp.basename(e),"-"),cleanFileNameMp3:fp.useExt(e,"mp3"),ext:fp.ext(e)};return{to:(e,t="")=>{const a=storageHost[e]?storageHost[e][t]:"";return Object.entries(i).reduce((e,[t,i])=>e.replaceAll(`{${t}}`,i),a)}}},twitterAccount=fromDynamicData("twitterAccount");Vue.component("Sharegroup",{name:"Sharegroup",props:{node:{required:!0,type:Object},editNodeTemplate:{type:String,default:""}},computed:{sharedUrl(){return url.fullPath(this.node.sharedUrl)},editNodeUrl(){return this.editNodeTemplate.replace("%d",this.node.objectID)},hasFurtherLinks(){return Boolean(this.editNodeUrl)}},template:`<li\n  :data-nid="node.objectID"\n  :id="'share-container-'+node.objectID"\n  class="share-container js-calc popover"\n>\n  <a\n    href="#"\n    title="share ${getAudioTypeSingular}"\n    class="button-icon secondary teaser-icons ojoo-icon-share"\n  > </a>\n  <ul class="share_groups">\n    <li class="popover-header">Share</li>\n    <li>\n      <a\n        :href="'https://www.facebook.com/share.php?u='+sharedUrl"\n        class="audio-share-facebook"\n        target="_blank"\n        title="share ${getAudioTypeSingular} on facebook"\n      ><i class="icon-facebook"></i>Facebook</a></li>\n    <li><a\n        :href="'https://twitter.com/intent/tweet?url='+sharedUrl+'&text=Check%20out%20this%20awesome%20`+getAudioTypeSingular+"%20by%20%40"+twitterAccount+`'"\n        target="_blank"\n        title="share ${getAudioTypeSingular} on twitter"\n      ><i class="icon-twitter"></i>Twitter</a></li>\n    <li><a\n        :href="sharedUrl"\n        class="audio-share-copy"\n        title="copy link to clipboard"\n      ><i class="icon-link"></i>Copy link</a></li>\n    <li v-if="hasFurtherLinks" class="popover-header">Edit</li>\n    <li v-if="editNodeUrl"><a\n      :href="'/'+editNodeUrl"\n      title="edit node"\n    >\n      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" class="icon-" viewBox="0 0 8 8" fill="noe"><path fill="#828282" d="M6.747.195a.665.665 0 0 0-.942 0L.667 5.333 0 8l2.667-.667 5.138-5.138a.665.665 0 0 0 0-.942L6.747.195z"/></svg>\n      </i>Edit Node</a>\n    </li>\n  </ul>\n</li>`}),Vue.component("favgroup",{props:{node:{type:Object,default:()=>({})}},data:()=>({isLoggedIn:isLoggedIn}),computed:{isFav(){return favorites.loaded.favNids.includes(this.node.objectID)},favGroups:()=>favorites.loaded.favGroups},template:`<li\n  :data-nid="node.objectID"\n  :id="'fav-container-'+node.objectID"\n  class="fav-container popover js-calc"\n>\n  <a\n    v-if="!isLoggedIn"\n    key="heart"\n    rel="modal:open"\n    href="/login"\n    title="add ${getAudioTypeSingular} to favorites"\n    class="button-icon secondary teaser-icons ojoo-icon-favorite"\n  > </a>\n  <a\n    v-if="isLoggedIn && isFav"\n    key="heart"\n    :href="'/favorite_nodes/delete/'+node.objectID"\n    title="remove ${getAudioTypeSingular} from favorites"\n    class="button-icon secondary teaser-icons ojoo-icon-favorite active"\n  > </a>\n  <a\n    v-if="isLoggedIn && !isFav"\n    key="heart"\n    :href="'/favorite_nodes/add/'+node.objectID"\n    title="add ${getAudioTypeSingular} to favorites"\n    class="button-icon secondary teaser-icons ojoo-icon-favorite"\n  > </a>\n  <ul\n    key="fav-groups"\n    v-if="isLoggedIn && !isFav && favGroups.length"\n    class="favorites_groups scrollbox-wrapper"\n  >\n    <li class="popover-header">Add to a list</li>\n    <ul class="scrollbox">\n      <li\n        v-for="favGroup in favGroups"\n        :key="favGroup.gid"\n      >\n        <a\n          :href="'/favorite_nodes/add/'+node.objectID+'/'+favGroup.gid"\n          :data-gid="favGroup.gid"\n          title="add ${getAudioTypeSingular} to favorites"\n          class="fav-add"\n        >{{ favGroup.title }}</a>\n      </li>\n    </ul>\n    <hr>\n    <li class="popover-header">Or create a new list</li>\n    <li>\n      <form\n        action="#"\n        method="post"\n        :id="'form-fav-group-'+node.objectID"\n      >\n        <div>\n          <div class="form-item">\n            <input\n              type="text"\n              maxlength="128"\n              name="edit[name]"\n              :id="'title-fav-group-'+node.objectID"\n              size="60"\n              value=""\n              placeholder="List Title"\n              class="form-text no-label"\n            >\n          </div>\n          <input\n            type="hidden"\n            name="edit[form_id]"\n            :id="'edit-form-fav-group-'+node.objectID"\n            :value="'form-fav-group-'+node.objectID"\n          >\n        </div>\n        <a\n        :href="'/favorites_group/add/'+node.objectID+'/'"\n        class="fav-group-add-button form-submit btn-full"\n      >Create and add to list</a>\n      </form>\n    </li>\n  </ul>\n  <ul\n    key="fav-groups"\n    v-if="isLoggedIn && !isFav && favGroups.length === 0"\n    class="favorites_groups"\n  >\n    <li class="popover-header">Create a list</li>\n    <li>\n      <form\n        action="#"\n        method="post"\n        :id="'form-fav-group-'+node.objectID"\n      >\n        <div>\n          <div class="form-item">\n            <input\n              type="text"\n              maxlength="128"\n              name="edit[name]"\n              :id="'title-fav-group-'+node.objectID"\n              size="60"\n              value=""\n              placeholder="List Title"\n              class="form-text no-label"\n            >\n          </div>\n          <input\n            type="hidden"\n            name="edit[form_id]"\n            :id="'edit-form-fav-group-'+node.objectID"\n            :value="'form-fav-group-'+node.objectID"\n          >\n        </div>\n        <a\n        class="fav-group-add-button form-submit btn-full"\n      >Create and add to list</a>\n      </form>\n    </li>\n  </ul>\n</li>`}),Vue.component("link-icon",{props:{type:String},template:`<a href="#" class="button-icon teaser-icons " :class="type ? 'primary ojoo-icon-'+type : 'secondary' " :title="type ? type : '' + ${getAudioTypeSingular}"></a>`}),Ojoo.simpleIconComponent=((e,t={})=>Vue.component(e,{template:`<i class="${e}" />`,...t})),Ojoo.simpleIconComponent("icon-facebook"),Ojoo.simpleIconComponent("icon-twitter"),Ojoo.simpleIconComponent("icon-link"),Vue.component("download-option",{props:{title:{type:String,required:!0},recommended:{type:Boolean,default:!1},href:{type:String,required:!0}},template:'<li>\n    <a :href="href">\n      {{ title }}\n      <span v-if="recommended" class="badge badge-primary">Recommended</span>\n    </a>\n  </li>'});const computedUrl=e=>(function(){const{audio:{filepath:t,storage:i},objectID:a}=this.node;return urlFor(t,a).to(e,i)}),downloadOptUrl=(e,t)=>{const{audio:{filepath:i,storage:a},objectID:s}=t;return urlFor(i,s).to(e,a)},streamUrl=computedUrl("stream"),peakUrl=computedUrl("peak");Vue.component("jp-extra-controls",{props:{node:{type:Object,required:!0}},data(){return{isLoggedIn:isLoggedIn,downloadOptions:downloadOptions,onUserDownloadsPage:this.$root.onUserDownloadsPage}},computed:{downloadUrl(){return downloadOptUrl(this.downloadOptions[0].index,this.node)}},methods:{downloadOptionUrl(e){return downloadOptUrl(e,this.node)}},template:"#extra-controls-template"}),Vue.component("audio-teaser",{props:{node:{type:Object,default:()=>({})},isOpen:{type:Boolean,default:!1},length:{type:Number,default:0}},data:()=>({isLoggedIn:isLoggedIn,viewPort:viewPort,downloadOptions:downloadOptions,onUserDownloadsPage:favorites.onUserDownloadsPage}),computed:{usersFreeTier:()=>"undefined"!=typeof userFreeTier?userFreeTier:{$emit:()=>{}},peakUrl:peakUrl,streamUrl:streamUrl,downloadUrl(){return downloadOptUrl(this.downloadOptions[0].index,this.node)}},methods:{capitalize:capitalize,downloadOptionUrl(e){return downloadOptUrl(e,this.node)},hasWaveForm(){if(!this.$el)return!1;try{return(this.$el.querySelectorAll(".wave")||[]).length}catch(e){return Ojoo.warn("failed .wave check"),!1}},initializeWaveForm(){if(!window.audioWavePlayer||!audioWavePlayer.initWavePlayer)return Ojoo.warn("audio-wave-player was not initialized");try{audioWavePlayer.initWavePlayer()}catch(e){Ojoo.warn("failed to load wave form",e)}var e=this.node.objectID,t="MediaElement";if(!msedge||!vivaldi)return Ojoo.warn("msedge or vivaldi undefined");(msedge>0||vivaldi>0)&&(t="WebAudio");try{wavesurfer[e]=WaveSurfer.create({audioContext:audiocontext,container:"#wave"+this.node.objectID,waveColor:theme.waveColor,progressColor:theme.progressColor,cursorColor:"transparent",height:44,mediaType:"audio",normalize:!0,hideScrollbar:!0,interact:!1,scrollParent:!1,backend:t}),audioWave.init({nid:e,title:this.node.title,peaks:this.peakUrl,song:this.streamUrl})}catch(e){Ojoo.warn("failed to initialize wave form")}},reset(){this.$refs.secondRow&&$j(this.$refs.secondRow).hide(),this.$refs.moreInfo&&this.$refs.moreInfo.classList.add("closed")}},mounted(){if(this.hasWaveForm())try{this.initializeWaveForm()}catch(e){Ojoo.warn("failed to load wave form")}this.isOpen&&(this.$refs.secondRow&&$j(this.$refs.secondRow).slideToggle(0),this.$refs.moreInfo&&this.$refs.moreInfo.classList.remove("closed")),this.$root.resetableComponents&&(this.__resetCallback=this.reset.bind(this),this.$root.resetableComponents.push(this.__resetCallback))},template:"#audio-teaser-template",beforeDestroy(){this.$root.resetableComponents=this.$root.resetableComponents.filter(e=>e!==this.__resetCallback)}}),Vue.component("expandable-simple-tag-list",{props:{tags:{type:Array,default:()=>[]},popoverHeader:{type:String,default:""},visible:{type:Number,default:2},primary:{type:Boolean,default:!1}},computed:{hiddenTags(){return this.tags.slice(this.visible)},visibleTags(){return this.tags.slice(0,this.visible)}},template:'<div>\n      <link-to\n        v-for="t in visibleTags"\n        :href="t.url"\n        :spa-open="() => $apps.url.singlePageLoad({ searchTerm: t.tag, pageType: filterToPageType[t.type], pathname: t.url })"\n        :class="[\'tag\', {\'tag-primary\': primary}]"\n        v-html="t.tag"\n        :key="\'tag-\'+t.tag"\n        v-truncate.min\n      ></link-to>\n      <span\n        class="popover js-calc js-hover"\n        v-if="hiddenTags.length"\n      >\n        <a\n          :class="[\'tag\', {\'tag-primary\': primary}]"\n          @click.prevent=""\n        >+{{hiddenTags.length}}</a>\n        <ul>\n          <li\n            v-if="popoverHeader"\n            class="popover-header"\n          >{{popoverHeader}}</li>\n          <li>\n            <div class="popover-content">\n            <link-to\n              v-for="t in hiddenTags"\n              :key="t.url"\n              :href="t.url"\n              :spa-open="() => $apps.url.singlePageLoad({ searchTerm: t.tag, pageType: t.type, pathname: t.url })"\n              class="tag"\n              v-html="t.tag"\n            ></link-to>\n            </div>\n          </li>\n        </ul>\n      </span>\n    </div>'});const favoritesApi="/api/favorites?nids=",favoritesOf=e=>({url:`/user/${e}/favorites`,list:t=>[favoritesOf(e).url,t].join("/")}),favorites=new Vue({mixins:[themesMixin],data(){const e=fromDynamicData("nid"),t=fromDynamicDataAsObject("favGroupListByCreated","data",0),i=0===Object.keys(t).length?"":t.uid,a=fromDynamicData("nids","nodes").split("|").filter(e=>e);e&&a.unshift(e);const s=fromDynamicDataAsInt("nidsTotal"),r=fromDynamicDataAsInt("perPage"),n=url.searchParams.has("page")&&Math.ceil(s/r)>=parseInt(url.searchParams.get("page"))>0&&parseInt(url.searchParams.get("page"))<=Math.ceil(s/r)?parseInt(url.searchParams.get("page")):0;return{api:favoritesApi,isLoggedIn:isLoggedIn,node:null,uid:i,loaded:{nodes:[],favNids:[],favGroups:[],categories:[],tags:[],nids:a,singleNid:e,total:s,perPage:r,visible:[],uiState:"loading",currentPage:n+1},isPublic:fromDynamicDataAsBoolean("nids","is_public"),isLoading:!1,listTitle:fromDynamicData("nids","title"),ownerName:fromDynamicData("nids","owner_name"),hasPermissionToEditList:fromDynamicDataAsBoolean("nids","has_permission"),shareForm:fromDynamicDataAsBoolean("nids","form"),getAudioTypeSingular:getAudioTypeSingular}},computed:{uiLoading(){return"loading"===this.loaded.uiState},uiShowingResults(){return"showingResults"===this.loaded.uiState},uiNoResults(){return"noResults"===this.loaded.uiState},totalPages(){return this.loaded.perPage?Math.ceil(this.loaded.total/this.loaded.perPage):1},showingResultsFrom(){return((this.loaded.currentPage||1)-1)*(this.loaded.perPage||1)+1},showingResultsTo(){const e=this.showingResultsFrom||1,t=this.loaded.perPage||1,i=this.loaded.total||0;return e+Math.min(i-e+1,t)-1},isOnMyFavoritesList(){return"0"===this.activeFavGroup.gid},assumedGid:()=>fromDynamicData("nids","gid")||"favorites",activeFavGroup(){return this.allFavGroups.find(({gid:e})=>e===this.assumedGid)||{gid:this.assumedGid,userName:this.ownerName,title:this.listTitle}},allFavGroups(){return[...this.preGeneratedFavlists,...this.loaded.favGroups]},preGeneratedFavlists(){return[{title:"All Favorites",gid:"favorites",url:""==this.uid?"":favoritesOf(this.uid).url}].filter(out.falsyValues)},isAnUserGeneratedList(){return this.loaded.favGroups.some(({gid:e})=>e===this.activeFavGroup.gid)},emptyListTitle(){return this.hasPermissionToEditList?this.isAnUserGeneratedList?"This list has no favorites":"You have no favorites":"The list is empty"},listDescription:()=>"Viewing all lists. Click to select a single list to view."},methods:{thousands_separators:thousands_separators,fromDynamicData:fromDynamicData,nextPage(e){e===this.loaded.currentPage+1?url.loadPageWithoutZero(this.loaded.currentPage):url.loadPageWithoutZero(e-1)},removeFromFavorites(e){this.loaded.nids.includes(e)&&(this.loaded.nids=this.loaded.nids.filter(t=>t!==e),this.loaded.total--)},loadFavGroups(){dynamic_data.favGroupListByTitle?this.loaded.favGroups=this.extractFavGroupsFrom(fromDynamicData("favGroupListByTitle","data")):this.loaded.favGroups=this.extractFavGroupsFrom(fromDynamicData("favGroupListByCreated","data"))},reloadFavGroups(){return fetch("/api/favorites_groups").then(e=>200!==e.status?Ojoo.warn("error reloading favorite groups"):e.json()).then(({data:e})=>{this.loaded.favGroups=this.extractFavGroupsFrom(e.data)})},extractFavGroupsFrom:e=>Object.values(e).map(e=>({...e,gid:String(e.gid),uid:String(e.uid),shared:phpParse(e.publish),url:favoritesOf(e.uid).list(e.gid)})),load(){return isLoggedIn?(this.loadFavGroups(),Promise.all([this.loadFavs(),this.loadNodes()])):this.loadNodes()},loadNodes(){return this.getNodes(this.loaded.nids).then(({hits:e,countNidsError:t})=>(t&&Ojoo.warn("Missing old results from total counts"),e.length<1?(this.loaded.uiState="noResults",{message:"[ojoo] No Nodes found!"}):(this.loaded.node=e[0],this.node=e[0],this.loaded.nodes.push(...e),this.loaded.visible.push(...e),this.loaded.uiState="showingResults",e))).catch(({message:e})=>(Ojoo.warn("problems while loading nodes:",e),[])).finally(e=>(remove_page_load(),e))},getNodes:(e=[])=>e&&e.length?byId(e):Promise.resolve({hits:[],countNidsError:!1}),loadFavs(){return this.getFavs(this.loaded.nids).then(e=>{this.loaded.favNids.push(...e)})},getFavs(e=[]){return e&&e.length?axios.get(this.api+e.join("|")).then(({data:{data:e=[]}})=>e.map(e=>String(e))).catch(err.handler()):Promise.resolve([])},toggleFavoriteListPrivacy(){return this.isLoading=!0,api.favoriteGroups.togglePrivacy(this.activeFavGroup.gid).then(({is_public:e})=>{this.isPublic=phpParse(e)}).catch(e=>{messagesApp.showError(e)}).finally(()=>this.isLoading=!1)},add(e){this.loaded.favNids.push(e)},remove(e){this.loaded.favNids=this.loaded.favNids.filter(t=>t!==e),this.loaded.total--}},created(){this.load(),this.$on("toggle-privacy",this.toggleFavoriteListPrivacy)},mounted(){}}),player=new Vue({data:()=>({showPlayer:!0,isLoggedIn:isLoggedIn,currentPlayingNid:""}),computed:{playableNodes:()=>void 0===searchApp?[...favorites.loaded.nodes]:[...favorites.loaded.nodes,...searchApp.returnedData],currentPlayingNode(){return this.playableNodes.find(({objectID:e})=>e===this.currentPlayingNid)}},methods:{setCurrentPlayingNid(e){this.currentPlayingNid=e}}});if("undefined"==typeof categories)throw"categories must be defined";const blockerMessage=(e,t)=>`<div class="blocker">\n    <div class="page-overlay-msg-wrapper">\n      <img src="${fromDynamicData("sleepImage")}" />\n      <h3>${e}</h3>\n      <a href="" class="button-link">${t}</a>\n    </div>\n  </div>`,empty=e=>!Object.keys(e).length,watch=(e,t)=>{if(e)return new MutationObserver(t).observe(e,{attributes:!0})};if("number"==typeof msie&&msie>0){if(!audiocontext)var audiocontext=""}else if(!audiocontext)audiocontext=new(window.AudioContext||window.webkitAudioContext);Vue.component("see-more",{props:{expansionSteps:{type:Array,required:!0},allItems:{type:Array,default:()=>[]},containerClass:{type:String,default:()=>""}},data:()=>({currentStep:0}),computed:{steps(){const e=this.expansionSteps.findIndex(e=>this.allItems.length<=e);return e<0?this.expansionSteps:this.expansionSteps.slice(0,e+1)},currentLimit(){return this.steps[this.currentStep]},showText(){return this.stepsText[this.currentStep]},stepsText(){const e=this.steps.length;if(e<=2)return["See more","See less"];const t=this.steps.map(()=>"See more");return t[e-2]="See all",t[e-1]="See less",t},visibleItems(){return this.allItems.slice(0,this.currentLimit)}},methods:{showMoreOrLess(){this.currentStep=(this.currentStep+1)%this.steps.length},resetState(){this.currentStep=0}},mounted(){this.$root.resetableComponents&&this.$root.resetableComponents.push(this.resetState.bind(this))},template:'<div>\n      <slot :visibleItems="visibleItems"></slot>\n      <a class="primary-link"\n        @click="showMoreOrLess()"\n        v-if="1 < steps.length"\n      >{{ showText }}</a>\n    </div>'}),Vue.component("collection-info",{props:["collectionData"],name:"collection-info",template:'<div\n    v-if="collectionData.description"\n    class="browse-vocabulary-excerpt description"\n  >\n    {{collectionData.description}}\n  </div>'}),Vue.component("artist-info",{props:{artistData:{type:Object,required:!0},total:{type:Number,required:!0}},computed:{totalTitle(){return thousands_separators(this.total)}},name:"artist-info",template:'<div>\n    <div v-if="artistData.bio" class="browse-vocabulary-excerpt description">\n      <limit-length :of="artistData.bio" :limit="200">\n        ...\n        <a href="#ex1" class="modal-link">Read more</a>\n        <div id="ex1" class="modal">\n          <div class="parent-title">Bio</div>\n          <h2>{{artistData.name}}</h2>\n          <p class="description">{{artistData.bio}}</p>\n        </div>\n      </limit-length>\n    </div>\n    <div class="row">\n      <div class="col-auto" v-if="artistData.location">\n        <h5>Location</h5>\n        <div class="description">{{artistData.location}}</div>\n      </div>\n      <div class="col-auto">\n        <h5>{{ artistData.audioName }}</h5>\n        <div class="description">{{ totalTitle }}</div>\n      </div>\n      <div\n        v-if="artistData.imdb\n          || artistData.twitter\n          || artistData.instagram\n          || artistData.soundcloud\n          || artistData.website"\n        class="col-auto"\n      >\n        <h5>Social &amp; Web</h5>\n        <div>\n          <social-icon :link-to="artistData.twitter" platform="twitter"></social-icon>\n          <social-icon :link-to="artistData.instagram" platform="instagram"></social-icon>\n          <social-icon :link-to="artistData.soundcloud" platform="soundcloud"></social-icon>\n          <social-icon :link-to="artistData.imdb" platform="imdb"></social-icon>\n          <social-icon :link-to="artistData.website" platform="web"></social-icon>\n        </div>\n      </div>\n    </div>\n  </div>'}),Vue.component("vocabulary-image",{props:{src:{type:String,default:""},alt:{type:String,default:""}},template:'<div class="browse-vocabulary-image col-md-4 col-12" v-if="src">\n      <img :src="src" :alt="alt" :title="alt" />\n    </div>'}),Vue.component("category-structured-data",{name:"category-structured-data",computed:{jsonld:()=>({"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:categories.active.map((e,t)=>({"@type":"ListItem",position:t+1,name:e.title,item:location.origin+e.url}))})},render(e){return e("script",{attrs:{type:"application/ld+json"},domProps:{innerHTML:JSON.stringify(this.jsonld,null,"  ")}})}}),Vue.component("sorting-nav",{props:["sortingMethod"],data:()=>({sortConfig:fromDynamicData("searchSortingConfig")}),template:'<collapsible-filter title="Sorting" class="sort_filter">\n    <div class="nav_content nav_cols-2">\n      <a\n        @click="$emit(\'toggle-sorting\')"\n        :class="[\'filter_item\', {filter_active:sortingMethod === sortConfig.relevance.value}]"\n      >{{ sortConfig.relevance.text }}</a>\n      <a\n        @click="$emit(\'toggle-sorting\')"\n        :class="[\'filter_item\', {filter_active:sortingMethod === sortConfig.dateAdded.value}]"\n      >{{ sortConfig.dateAdded.text }}</a>\n    </div>\n  </collapsible-filter>'}),Vue.component("collapsible-filter",{props:["title"],data:()=>({isOpen:!0}),template:'<div class="nav_container">\n    <div class="nav_header">\n      <div class="nav_item" @click="isOpen = !isOpen">\n        {{ title }}\n        <i :class="[ \'nav_caret\', \'icon-caret_top_big\', isOpen ? \'opened\' : \'closed\' ]"></i>\n      </div>\n    </div>\n    <div class="nav_body" :style="{ display: isOpen ? \'block\' : \'none\' }">\n      <slot></slot>\n    </div>\n  </div>'}),Vue.component("collapsible-item",{props:{stayOpen:{type:Boolean,default:()=>!1}},data:()=>({isOpen:!1}),computed:{showOpen(){return this.stayOpen||this.isOpen}},methods:{resetState(){this.isOpen=!1},toggle(){this.isOpen=!this.isOpen}},mounted(){this.$root.resetableComponents.push(this.resetState.bind(this))},template:'<div>\n      <slot name="item" :isOpen="showOpen" :toggle="toggle"></slot>\n      <template v-if="showOpen">\n        <slot name="collapsible"></slot>\n      </template>\n    </div>'}),Vue.component("collapsible-see-more-filter",Vue.component("see-more").extend(Vue.component("collapsible-filter").extend({template:'<div class="nav_container">\n      <div class="nav_header">\n        <div class="nav_item" @click="isOpen = !isOpen">\n          {{title}}\n          <i :class="[ \'nav_caret\', \'icon-caret_top_big\', isOpen ? \'opened\' : \'closed\' ]"></i>\n        </div>\n      </div>\n      <div class="nav_body" :style="{ display: isOpen ? \'block\' : \'none\' }">\n        <slot :visibleItems="visibleItems"></slot>\n        <a class="primary-link"\n          @click="showMoreOrLess()"\n          v-if="1 < steps.length"\n        >{{ showText }}</a>\n      </div>\n    </div>'}))),Vue.component("slideable-filter",{props:{title:{type:String,default:"Filter"},min:Number,max:Number,selectedMin:Number,selectedMax:Number,convertTo:{type:Function,default:e=>e},convertFrom:{type:Function,default:e=>parseInt(e)},unit:{type:String,default:""}},data(){return{curTrack:null,percentInPx:2.1,trackX:45,directInputMode:!1,isDragging:!1,localMin:this.selectedMin||this.min,localMax:this.selectedMax||this.max,triggerFiltering:null}},computed:{step(){return this.min===this.max?1:(this.max-this.min)/100},selectedMinPercent(){return Math.max(0,this.valueToPercent(this.localMin))},selectedMaxPercent(){return Math.min(100,this.valueToPercent(this.localMax))}},watch:{selectedMin(e){this.localMin=is.number(e)?e:this.min},selectedMax(e){this.localMax=is.number(e)?e:this.max},min(e){this.localMin=this.localMin<=e?this.min:e},max(e){this.localMax=e<=this.localMax?this.max:e},directInputMode(e){e||this.emitFilter()},localMin(){this.emitFilter()},localMax(){this.emitFilter()}},methods:{leaveDirectInputMode(){this.directInputMode=!1},enterDirectInputMode(){this.directInputMode=!0},emitFilter(){clearTimeout(this.triggerFiltering),this.triggerFiltering=setTimeout(()=>this.updateFilter(),this.isDragging?350:0)},updateFilter(){let e=this.clamp(this.localMin),t=this.clamp(this.localMax);t<e&&([e,t]=[t,e]),e===t&&t++,this.$emit("filter",{min:e<=this.min?null:e,max:this.max<=t?null:t})},clamp(e){return is.number(e)?minMaxVal(this.min,this.max,e):null},moveTrack(e){const t=this.curTrack;let i=(e.clientX-this.trackX)/this.percentInPx;i=minMaxVal(0,100,i);let a=this.percentToValue(i);"track1"===t&&(a>=this.localMax&&(a=this.localMax-1),this.localMin=minMaxVal(this.min,this.localMax,a)),"track2"===t&&(a<=this.localMin&&(a=this.localMin+1),this.localMax=minMaxVal(this.localMin,this.max,a))},dragstart(e){this.isDragging||(this.max-this.step<this.localMax&&this.max-2*this.step<this.localMin&&(e="track1"),this.isDragging=!0,this.curTrack=e)},dragmove(e){this.isDragging&&this.moveTrack(e)},dragend(){this.isDragging&&(this.isDragging=!1)},percentToValue(e){return Math.round(e*this.step)+this.min},valueToPercent(e){return Math.round((e-this.min)/this.step)},setClickMove(e){let t=this.$refs.track1.getBoundingClientRect().left,i=this.$refs.track2.getBoundingClientRect().left;e.clientX<t?(this.curTrack="track1",this.moveTrack(e)):e.clientX-t<i-e.clientX?(this.curTrack="track1",this.moveTrack(e)):(this.curTrack="track2",this.moveTrack(e))}},mounted(){document.body.addEventListener("mousemove",this.dragmove,{passive:!0}),document.body.addEventListener("mouseup",this.dragend),document.body.addEventListener("mouseleave",this.dragend)},template:'<collapsible-filter :title="title" class="slider-track">\n    <div v-if="!directInputMode" class="inline-edit sm length_period">\n      {{ convertTo(localMin) }} - {{ convertTo(localMax) }} {{unit}}\n      <span class="ojoo-icon-edit" @click="enterDirectInputMode"></span>\n    </div>\n    <div v-if="directInputMode" class="inline-edit sm length_period">\n        <input\n          class="form-text"\n          size="5"\n          :value="convertTo(localMin)"\n          @change="localMin = convertFrom($event.target.value)"\n          :placeholder="convertTo(localMin)"\n          @keypress.enter="leaveDirectInputMode"\n        />\n        <span class="to">-</span>\n        <input\n          class="form-text"\n          size="5"\n          :value="convertTo(localMax)"\n          @change="localMax = convertFrom($event.target.value)"\n          :placeholder="convertTo(localMax)"\n          @keypress.enter="leaveDirectInputMode"\n        />\n      <span class="link" @click="leaveDirectInputMode">Update</span>\n    </div>\n    <div class="track-container" v-cloak>\n      <div class="track" @click="setClickMove"></div>\n      <div\n        class="track-highlight"\n        @click="setClickMove"\n        :style="{left: \'\'+selectedMinPercent+\'%\',\n                width: \'\' + (selectedMaxPercent - selectedMinPercent) + \'%\'}"\n      ></div>\n      <button\n        class="track-btn track1"\n        :style="{left: \'\' +selectedMinPercent+\'%\'}"\n        ref="track1"\n        @mousedown="dragstart(\'track1\')"\n        @touchstart="dragstart(\'track1\')"\n        @mousemove="dragmove($event)"\n        @touchmove="dragmove($event.changedTouches[0])"\n        @mouseup="dragend()"\n        @touchend="dragend()"\n      ></button>\n      <button\n        class="track-btn track2"\n        :style="{left: \'\' + selectedMaxPercent + \'%\'}"\n        ref="track2"\n        @mousedown="dragstart(\'track2\')"\n        @touchstart="dragstart(\'track2\')"\n        @mousemove="dragmove($event)"\n        @touchmove="dragmove($event.changedTouches[0])"\n        @mouseup="dragend()"\n        @touchend="dragend()"\n      ></button>\n      <span class="range-value min">{{ convertTo(min) }}</span>\n      <span class="range-value max">{{ convertTo(max) }}</span>\n    </div>\n  </collapsible-filter>'});const urldecode=(e="")=>decodeURIComponent(e.replace(/%(?![\da-f]{2})/gi,()=>"%25").replace(/\+/g,"%20")),defaults={min:0,max:4200,minBpm:4e3,maxBpm:16e3,artist:{uid:0,name:"",bio:"",imdb:"",image_cover:null,instagram:null,twitter:null,soundcloud:null,website:null,location:null}},ui={initialPageLoad:"initial-page-load",isSearching:"is-searching",showingResults:"showing-search-results",showingNoResults:"showing-no-results",showingFilterTooStrict:"showing-filter-too-strict"};function paramsFromUrl(){return{sortingMethod:url.intParam("sorting",1),currentPage:url.intParam("page",1),initSearchTerm:url.searchParams.get("query"),min:url.intArrayParam("minaudio")[1],max:url.intArrayParam("maxaudio")[1],selectedMin:url.intArrayParam("minaudio")[0]||null,selectedMax:url.intArrayParam("maxaudio")[0]||null,minBpm:url.intArrayParam("minbpm")[1],maxBpm:url.intArrayParam("maxbpm")[1],selectedMinBpm:url.intArrayParam("minbpm")[0]||null,selectedMaxBpm:url.intArrayParam("maxbpm")[0]||null,filteredTags:url.arrayParam("filteredTags"),filteredCategories:url.arrayParam("filteredCategories"),filteredSimilar:url.arrayParam("filteredSimilar"),filteredMood:url.arrayParam("filteredMood"),filteredSubCategories:url.arrayParam("filteredSubCategories"),filteredLibraries:url.arrayParam("filteredLibraries")}}const searchApp=new Vue({data(){const e=paramsFromUrl(),t=fromDynamicDataWithDefault("dynamic_search")("pageType");let i=e.initSearchTerm||String(findFromDynamicData("",["userUid"],["query"],["searchText"]));return"dynamic_category"!==t&&"dynamic_genre"!==t||(i=[categories.byEmpty(i).tag,categories.byEmpty(location.pathname).tag,dynamic_data.searchText,1<url.pathParts.length?` > ${i}`:i].find(Boolean)),this.ui=ui,this.defaults=defaults,{...e,all:all,url:url,items:items,init:{pageType:t,searchTerm:i,...items.pick(e,"min","max","minBpm","maxBpm")},userUid:"",artistData:defaults.artist,collectionData:{},mounted:!1,loadingExtraAsset:!1,currentPlaying:"",resetableComponents:[],searchRequestsInProgress:0,searchRequestsDone:0,allCategories:[],allSubCategories:[],allLibraries:[],allMood:[],allSimilar:[],allTags:[],totalHits:0,perPage:fromDynamicDataWithDefault(15)("perPage"),preUpdateHeight:px(window.height+150),returnedData:[],audio_grace_timeout:null,tagHeadPromotion:!1,isLoggedIn:isLoggedIn,showPlayer:!0,capturedInitialHistoryState:!1,onUserDownloadsPage:favorites.onUserDownloadsPage,searchMode:"fuzzy",hasSearchMode:fromDynamicData("searchMode"),subsByCat:new DefaultMap(()=>[]),facetCache:new Map,bodyOverlay:bodyOverlay}},watch:{totalPages(e){e<=this.currentPage&&(this.currentPage=e)},"bodyOverlay.isActive":{handler(e){e&&(this.$refs.sideNav.style.height="auto",this.$refs.sideNav.style.bottom="0")}},searchTerm(e){querySuggestApp.searchInputText=this.isSearchPage?this.searchTerm:""},"init.searchTerm":{handler(){this.updateHistory()}},"init.pageType":{handler(){this.updateHistory()}},"url.url":{handler(e,t){window.isOnSearchPage&&(url.isHandlingPopstate?this.recreateHistory():this.updateHistory(),this.searchFor(),this.$nextTick(function(){this.loadArtistData(),this.loadCollectionData(),console.groupEnd()}))},immediate:!0},init(){this.resetComponents(),this.$nextTick(()=>{this.loadArtistData(),this.loadCollectionData()}),url.isHandlingPopstate||this.clearAllFilter()},searchParams:{handler:function(e,t){is.equal(e,t)||this.updateUrl()}},searchMode(e){search.mode=e},returnedData(e){if(!e)return;const t=e.map(e=>e.id);if(!isLoggedIn||!t.length)return;const i=new URL(location.origin+favoritesApi);i.searchParams.set("nids",t.join("|")),fetch(i.pathname+i.search).then(okJson).then(({data:e=[]})=>{favorites.loaded.favNids.push(...e.map(String))}).catch(err.handler()),this.sideNavOverlayHandler()},sortingMethod(){this.currentPage=1},windowTitle:{handler:function(e){if(!window.isOnSearchPage)return;if(!this.searchRequestsDone)return;const t=e+dynamic_data.titleSuffix;document.title.trim()!==t&&(document.title=t)}}},beforeUpdate(){if(!this.$refs.searchResultsWrapper||this.uiInitialPageLoad)return;const{height:e}=getComputedStyle(this.$refs.searchResultsWrapper);parseInt(e)&&(this.preUpdateHeight=e)},computed:{isMobile(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},searchModeType(){return"fuzzy"===this.searchMode?"Enable Strict Mode":"Enable Fuzzy Mode"},searchTerm(){return this.isCategoryPage?categories.current.title||capitalizeEachWord(this.init.searchTerm.replace(" > ","")):this.init.searchTerm},pageTitle(){if(this.isArtistPage)return this.artistData.name||"";if(this.isCategoryPage){const e=categories.current.title?categories.current.title:this.init.searchTerm;return e.includes(" > ")?e.split(" > ")[1]:e}const e=all.by(this.init.searchTerm);return e?capitalize(e.tag):capitalize(this.all.activeItem.tag)||capitalize(this.init.searchTerm)||""},pageHeading(){return no_heading_pages.includes(this.pageType)?"":this.inAllMode?fromDynamicData("searchPageAllHeading"):no_heading_pages.includes(this.pageType)?"":fromDynamicData("searchPageDefaultHeading")},searchPageHeadline(){return[this.pageTitle,this.pageHeading].filter(Boolean).join(" ")},uiState(){return this.searchRequestsInProgress?this.searchRequestsDone<this.searchRequestsInProgress?ui.isSearching:this.totalHits?ui.showingResults:this.hasFilters?ui.showingFilterTooStrict:ui.showingNoResults:ui.initialPageLoad},uiInitialPageLoad(){return this.uiState===ui.initialPageLoad},uiSearching(){return this.uiState===ui.isSearching},uiShowingResults(){return this.uiState===ui.showingResults},uiShowingNoResults(){return this.uiState===ui.showingNoResults},uiShowingFilterTooStrict(){return this.uiState===ui.showingFilterTooStrict},isCurrentLoading(){return this.uiInitialPageLoad||this.uiSearching},totalPages(){return Math.ceil(this.totalHits/this.perPage)||1},pageType(){return this.init.pageType||"dynamic_search"},allFilteredTags(){return[...this.filteredTags,this.initTag].filter(Boolean)},allFilteredCategories(){return uniq([...this.filteredCategories,this.initCategory,...this.allFilteredSubCategories.map(e=>e.split(" > ")[0])]).filter(Boolean)},allFilteredSubCategories(){return[...this.filteredSubCategories,this.initSubCategory].filter(Boolean)},allFilteredSimilar(){return[...this.filteredSimilar,this.initSimilar].filter(Boolean)},allFilteredMood(){return[...this.filteredMood,this.initMood].filter(Boolean)},allFilteredLibraries(){return[...this.filteredLibraries,this.initLibrary].filter(Boolean)},initTag(){return this.isTagPage&&this.init.searchTerm?this.init.searchTerm.toLowerCase():""},initCategory(){return this.isCategoryPage&&this.init.searchTerm?this.init.searchTerm.includes(" > ")?"":this.init.searchTerm.toLowerCase():""},initSubCategory(){return this.isCategoryPage&&this.init.searchTerm&&this.init.searchTerm.includes(" > ")?this.init.searchTerm.toLowerCase():""},initSimilar(){return this.isSimilarPage&&this.init.searchTerm?this.init.searchTerm.toLowerCase():""},initMood(){return this.isMoodPage&&this.init.searchTerm?this.init.searchTerm.toLowerCase():""},initLibrary(){return this.isArtistPage&&this.init.searchTerm?this.init.searchTerm.toLowerCase():""},initInstrument(){return this.isInstrumentPage&&this.init.searchTerm?this.init.searchTerm.toLowerCase():""},selectableTags(){return this.allTags.filter(([e])=>this.initTag!==e).sort(facetByCount)},selectableSimilar(){return this.allSimilar.filter(([e])=>this.initSimilar!==e).sort(facetByCount)},selectableMoods(){return this.allMood.filter(([e])=>this.initMood!==e).sort(facetByCount)},hasFilters(){return this.hasLibraryFilter||this.hasPlayTimeFilter||this.hasBpmFilter||this.hasCategoryFilter||this.hasSimilarFilter||this.hasMoodFilter||this.hasSubCategoryFilter||this.hasTagFilter},hasTagFilter(){return Boolean(this.filteredTags.length)},hasCategoryFilter(){return Boolean(this.filteredCategories.length)},hasSimilarFilter(){return Boolean(this.filteredSimilar.length)},hasMoodFilter(){return Boolean(this.filteredMood.length)},hasSubCategoryFilter(){return Boolean(this.filteredSubCategories.length)},hasLibraryFilter(){return Boolean(this.filteredLibraries.length)},hasPlayTimeFilter(){return is.number(this.selectedMin)||is.number(this.selectedMax)},hasBpmFilter(){return is.number(this.selectedMinBpm)||is.number(this.selectedMaxBpm)},showEnableFuzzyMode(){return!this.isCurrentLoading&&0==this.numberHits&&!this.hasFilters&&"fuzzy"!=this.searchMode},showChangeSearchTerm(){return!this.isCurrentLoading&&0==this.numberHits&&!this.hasFilters&&"fuzzy"===this.searchMode},isSearchPage(){return"dynamic_search"===this.pageType},isCategoryPage(){return"dynamic_category"===this.pageType||"dynamic_genre"===this.pageType},isArtistPage(){return"dynamic_user"===this.pageType},isCollectionPage(){return this.pageType.startsWith("dynamic_playlist")},isTagPage(){return"dynamic_tag"===this.pageType||"dynamic_attribute"===this.pageType},isSimilarPage(){return"dynamic_similar_to"===this.pageType},isMoodPage(){return"dynamic_mood"===this.pageType},isInstrumentPage(){return"dynamic_instrument"===this.pageType},currentPlayingNode(){return this.returnedData.find(({objectID:e})=>e===this.currentPlaying)},getBasicPages(){return(this.currentPage-1)*this.perPage},getBasicMaxPage(){return this.totalHits<this.getBasicPages+this.perPage?this.totalHits:this.getBasicPages+this.perPage},categories:()=>categories,searchParams(){const e=this.inAllMode?[fromDynamicData("searchFilterType"),fromDynamicData("staffPickKeyWord")].filter(Boolean).join(" "):this.searchTerm;return{filter_by:this.searchFilterFor({filteredLibraries:this.allFilteredLibraries,filteredTags:this.allFilteredTags,filteredCategories:this.allFilteredCategories,filteredSubCategories:this.allFilteredSubCategories,filteredSimilar:this.allFilteredSimilar,filteredMood:this.allFilteredMood,initInstrument:this.initInstrument,isCollectionPage:this.isCollectionPage,selectedMin:this.selectedMin,selectedMax:this.selectedMax,selectedMinBpm:this.selectedMinBpm,selectedMaxBpm:this.selectedMaxBpm}),q:e,page:this.currentPage,sort_by:1===this.sortingMethod?"_text_match:desc,fairness:desc":"created:desc"}},inAllMode(){return!this.searchTerm&&this.isSearchPage&&hasPromotedFacets},windowTitle(){const e=this.currentPage>1?["Page",this.currentPage].join(" "):"",t=[this.isSearchPage?"Search":"",this.pageTitle].filter(Boolean).join(" ");return[e,...this.isCategoryPage?categories.current.active||[]:[t]].filter(Boolean).map(e=>capitalizeEachWord(e)).join(" | ")}},methods:{facetByCount:facetByCount,toMinSeconds:toMinSeconds,fromMinSeconds:fromMinSeconds,convertBpmToClient:convertBpmToClient,convertBpmToSearchEngine:convertBpmToSearchEngine,fromDynamicData:fromDynamicData,capitalize:capitalize,thousands_separators:thousands_separators,toggleSearchMode(){this.searchMode="strict"===this.searchMode?"fuzzy":"strict"},loadArtistData(){if(!this.isArtistPage)return this.artistData=defaults.artist;const e=is.numeric(this.init.searchTerm)?all.by(this.init.searchTerm):all.by(location.pathname);if(e&&e.loaded)return this.artistData=e;const t=e?e.tag:this.init.searchTerm||"";this.loadingExtraAsset=!0,axios.get(userDataAPI+"?u="+urlize(t)).then(({data:{data:e}})=>{this.artistData=itemFrom(t,0,{...e,audioName:getAudioTypePlural,url:e.url?e.url:location.pathname,type:"artist",uid:String(e.uid),loaded:!0})}).catch(()=>{console.warn("[ojoo] failed fetching artist data for artist: "+t),this.artistData=defaults.artist}).finally(()=>this.loadingExtraAsset=!1)},loadCollectionData(){this.isCollectionPage&&(this.loadingExtraAsset=!0,this.collectionData={},axios.get(collectionDataAPI+"?t="+encodeURIComponent(this.searchTerm)+"&v="+this.pageType.split("_")[1]).then(e=>{const t={...e.data.data[0]};all.add(t),this.collectionData=t}).catch(err.handler()).finally(()=>this.loadingExtraAsset=!1))},updateHistory(){if(url.isHandlingPopstate)return;const e={selectedMin:this.selectedMin,selectedMax:this.selectedMax,selectedMinBpm:this.selectedMinBpm,selectedMaxBpm:this.selectedMaxBpm};init.set({init:{searchTerm:"*",...this.init},selected:e})},recreateHistory(){const e=paramsFromUrl();let{selected:t,init:i,...a}=init.get()||{},{searchTerm:s}=i||{};is.empty(i)||(this.isSearchPage&&!s&&(s=e.initSearchTerm),this.initializePageFilter({init:{...a,...i,searchTerm:s},paramsToAssign:items.removeNullyValues({...t,...e})}))},too_many_requests(){document.body.innerHTML+=blockerMessage("Your system has generated too many requests. Please wait a few minutes and try again.","Retry Request")},set_audio_grace_timeout(){clearTimeout(this.audio_grace_timeout),this.audio_grace_timeout=setTimeout(()=>{document.body.innerHTML+=blockerMessage("You were inactive for quite some time","Refresh results")},15e5)},setCurrentPlayingNid(e){this.currentPlaying=e},toggleSorting(){this.sortingMethod=1===this.sortingMethod?2:1},clearAllFilter(){this.sortingMethod=1,this.currentPage=1,this.clearTagFilter(),this.clearSimilarFilter(),this.clearMoodFilter(),this.clearCategoryFilter(),this.clearLibraryFilter(),this.clearPlayTimeFilter(),this.clearBpmFilter()},clearCategoryFilter(){this.filteredCategories=[],this.filteredSubCategories=[]},clearSimilarFilter(){this.filteredSimilar=[]},clearMoodFilter(){this.filteredMood=[]},clearTagFilter(){this.filteredTags=[]},clearLibraryFilter(){this.filteredLibraries=[]},clearPlayTimeFilter(){this.selectedMin=null,this.selectedMax=null},clearBpmFilter(){this.selectedMinBpm=null,this.selectedMaxBpm=null},getMinHeight:()=>window.innerHeight,urlencode:e=>(e+="",encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/~/g,"%7E").replace(/%20/g,"+")),updatePlayTimeFilter({min:e,max:t}){this.selectedMin=e,this.selectedMax=t},updateBpmFilter({min:e,max:t}){this.selectedMinBpm=e,this.selectedMaxBpm=t},resetComponents(){this.resetableComponents.forEach(e=>e())},searchFilterFor({filteredLibraries:e=null,filteredCategories:t=null,filteredSubCategories:i=null,filteredTags:a=[],filteredSimilar:s=[],filteredMood:r=[],initInstrument:n=null,isCollectionPage:o=!1,selectedMin:l=null,selectedMax:d=null,selectedMinBpm:c=null,selectedMaxBpm:h=null,type:u=fromDynamicData("searchFilterType")}){let m=is.array(e)?e[0]:e;const p=(i=q.oneOrMany(i))&&is.string(i)&&i.split(" > ")[0]?q.isEq:q.is;return this.searchFilterOf([...q.andIsEq(searchFieldOf("similar_to"),s),...q.andIsEq(searchFieldOf("mood"),r),q.isEq(searchFieldOf("category"),t),p(searchFieldOf("subCategory"),i),q.isEq(is.numeric(m)?"user.uid":"user.url",e),q.isEq(searchFieldOf("instrument"),n),...q.andIsEq(searchFieldOf(o?"playlist":"tag"),a),q.range(searchFieldOf("playTime"),[l,d]),q.range(searchFieldOf("bpm"),[c,h]),q.isEq("type",u)])},searchFilterOf:(e=[])=>e.filter(Boolean).join(" && "),initializePageFilter({pageType:e=this.pageType,searchTerm:t=this.init.searchTerm,paramsToAssign:i={},init:a,...s}){is.number(this.init.min)&&(this.min=this.init.min),is.number(this.init.max)&&(this.max=this.init.max),is.number(this.init.minBpm)&&(this.minBpm=this.init.minBpm),is.number(this.init.maxBpm)&&(this.maxBpm=this.init.maxBpm),this.init={pageType:e,searchTerm:t,...a,...s},is.nonEmptyObject(i)&&Object.assign(this,i)},searchFor(){if(this.uiSearching)return;let e=this.inAllMode&&!this.hasFilters&&1===this.sortingMethod?[fromDynamicData("searchFilterType"),fromDynamicData("staffPickKeyWord")].filter(Boolean).join(" "):this.init.searchTerm;!this.searchRequestsInProgress&&this.hasFilters&&(this.searchRequestsInProgress++,search({q:e,filter_by:this.searchFilterOf([this.isSearchPage?"":q.isEq(searchFieldOf(pageTypeToFilter[this.init.pageType]),this.init.searchTerm),q.isEq("type",fromDynamicData("searchFilterType"))]),typo_tokens_threshold:5}).then(({facets:e,found:t})=>{this.prepareFilters(e),this.totalHits=t,this.init.totalHits||(this.init.totalHits=t)}).finally(()=>{this.searchRequestsDone++})),this.currentPlaying?(this.currentPlayingNode.hidden=!0,this.returnedData=[this.currentPlayingNode]):this.returnedData=[],this.searchRequestsInProgress++;const t={filter_by:this.searchFilterFor({filteredLibraries:q.oneOrMany(this.allFilteredLibraries),filteredTags:this.allFilteredTags,filteredCategories:q.oneOrMany(this.allFilteredCategories),filteredSubCategories:q.oneOrMany(this.allFilteredSubCategories),filteredSimilar:this.allFilteredSimilar,filteredMood:this.allFilteredMood,initInstrument:this.initInstrument,isCollectionPage:this.isCollectionPage,selectedMin:this.selectedMin,selectedMax:this.selectedMax,selectedMinBpm:this.selectedMinBpm,selectedMaxBpm:this.selectedMaxBpm}),q:e,page:this.currentPage,sort_by:1===this.sortingMethod?"_text_match:desc,fairness:desc":"created:desc"};return pageTypeToFilter[this.pageType]&&(t.query_by=t.q.includes(" > ")?searchFieldLvl1Of(pageTypeToFilter[this.pageType]):searchFieldOf(pageTypeToFilter[this.pageType]),t.query_by_weights="1"),search(t).then(({hits:e,found:t,facets:i})=>{this.currentPlaying?(this.currentPlayingNode.hidden=!e.map(e=>e.objectID).includes(this.currentPlaying),this.returnedData=[this.currentPlayingNode,...e.filter(e=>e.objectID!==this.currentPlaying)]):this.returnedData=e,this.prepareFilters(i),this.totalHits=t,this.init.totalHits||(this.init.totalHits=t),window.scrollTo(0,0)}).finally(()=>this.searchRequestsDone++)},updateUrl(){let e={query:this.isSearchPage?this.searchTerm:"",page:1===this.currentPage?void 0:this.currentPage,sorting:1===this.sortingMethod?void 0:this.sortingMethod,minaudio:is.number(this.selectedMin)?[this.selectedMin,this.init.min||this.min]:null,maxaudio:is.number(this.selectedMax)?[this.selectedMax,this.init.max||this.max]:null,minbpm:is.number(this.selectedMinBpm)?[this.selectedMinBpm,this.init.minBpm||this.minBpm]:null,maxbpm:is.number(this.selectedMaxBpm)?[this.selectedMaxBpm,this.init.minBpm||this.maxBpm]:null,filteredCategories:btoa(this.urlencode(this.filteredCategories.toString())),filteredSimilar:btoa(this.urlencode(this.filteredSimilar.toString())),filteredMood:btoa(this.urlencode(this.filteredMood.toString())),filteredSubCategories:btoa(this.urlencode(this.filteredSubCategories.toString())),filteredTags:btoa(this.urlencode(this.filteredTags.toString())),filteredLibraries:btoa(this.urlencode(this.filteredLibraries.toString()))};e=items.selecting(e,...allowedSearchUrlParams),url.change({searchParams:e})},toggleFilters(e,t){const i=this[e];i.includes(t)?this[e]=ary.removeFrom(i,t):this[e]=ary.addTo(i,t),this.lastFiltered=e},addTagsFilter(e){this.toggleFilters("filteredTags",e)},addSimilarFilter(e){this.toggleFilters("filteredSimilar",e)},addMoodFilter(e){this.toggleFilters("filteredMood",e)},addLibraryFilter(e){this.toggleFilters("filteredLibraries",e)},addCategoriesFilter(e){this.filteredSubCategories=this.filteredSubCategories.filter(t=>!t.startsWith(e)),this.toggleFilters("filteredCategories",e)},addSubCategoriesFilter(e){const[t]=e.split(" > ");this.filteredCategories=ary.removeFrom(this.filteredCategories,t),this.toggleFilters("filteredSubCategories",e)},fetchPage(e){this.isCurrentLoading||(this.currentPage=e)},autoScrollSubCategories(){var e=window.innerWidth;setTimeout(function(){var t=document.querySelector(".sub-categories-container");if(t){var i=t.querySelector(".filter_active");i&&(i=i.getBoundingClientRect().left)>e&&t.scrollTo({left:i,behavior:"smooth"})}else Ojoo.warn("No sub categories container found")},200)},unixDateTime:()=>Math.round(+new Date/1e3),cacheFacets(e){e.forEach(e=>this.facetCache.set(e[0],e))},refreshFacets(e){e.forEach(([e,t])=>{const i=this.facetCache.get(e);if(!i)return console.warn("item not found for ",e);i[1]=t})},initializeWith({name:e,facets:t,extract:i=(e=>e),refresh:a=this.refreshFacets,keepInitial:s=!1}){const r=this[e];if(t.length)if(!r.length||!s||r.length<t.length){const a=i(t).filter(([e])=>e);this[e]=a,this.cacheFacets(a)}else a(r,t)},prepareFilters(e){const t=withReturned(e);this.initializeWith({name:"allCategories",facets:t("category")}),this.initializeWith({name:"allSubCategories",facets:t("subCategory"),extract:e=>(this.subsByCat.clear(),e.map(([e,t])=>{if(!e)return["",0];const[i,a]=e.split(" > "),s=[e,t,"",a];return this.subsByCat.get(i).push(s),s}))}),this.initializeWith({name:"allSimilar",facets:t("similar_to")}),this.initializeWith({name:"allMood",facets:t("mood")}),this.initializeWith({name:"allTags",facets:t("tag")}),this.initializeWith({name:"allLibraries",facets:pairs(e.libraryFacet||{}),extract:e=>e.map(([e,t])=>{const[i,a]=e.split(":");return[e,t,i,a]})});let{min:i=defaults.min,max:a=defaults.max}=e["audio.playTime"]||{};is.number(this.init.min)||(this.init.min=i),is.number(this.init.max)||(this.init.max=a);let{min:s=defaults.minBpm,max:r=defaults.maxBpm}=e["audio.bpm"]||{};is.number(this.init.minBpm)||(this.init.minBpm=s),is.number(this.init.maxBpm)||(this.init.maxBpm=r)},recalculateHeight(){if(!this.isMobile&&!this.uiShowingNoResults){this.bodyOverlay.isActive=!1;var e=document.getElementById("header-wrapper").offsetHeight,t=document.getElementsByClassName("jp-type-playlist")[0],i=0;t&&"none"!==window.getComputedStyle(t).display&&(i=t.offsetHeight);this.$refs.sideNav.style.height=this.getMinHeight()-e-0-i+"px"}},setupRefreshBlocker(){this.set_audio_grace_timeout(),setInterval(()=>{axios.get("/_refresh_").then(()=>{this.set_audio_grace_timeout()}).catch(err.handler())},9e5)},sideNavOverlayHandler(){if(!this.$refs.sideNav.classList.contains("js-overlay-show")){var e=document.getElementById("header-wrapper").offsetHeight,t=document.getElementsByClassName("jp-type-playlist")[0],i=0;"none"!==getComputedStyle(t).display&&(i=t.offsetHeight);this.$refs.sideNav.style.height=searchApp.getMinHeight()-e-0-i+"px"}},updateSideNavStick(){if(!this.mounted)return;this.tagHeadPromotion=this.$refs.greenBar;var e=document.getElementsByClassName("jp-type-playlist")[0],t=0;if(!e)return Ojoo.warn("no audio player");window.getComputedStyle(e).display&&"none"!==window.getComputedStyle(e).display&&(t=e.offsetHeight);var i=id("footer"),a=this.$refs.sideNav;const s=window.pageYOffset||document.body.scrollTop;if(a)if(s-t>i.offsetTop||s-t+this.getMinHeight()>i.offsetTop&&this.totalHits>=15?a.classList.add("nav-relative"):a.classList.remove("nav-relative"),this.tagHeadPromotion){var r=this.$refs.greenBar;s<r.offsetTop?a.classList.add("nav-top-custom"):s>r.offsetTop&&a.classList.remove("nav-top-custom")}else a.classList.remove("nav-top-custom")}},mounted(){this.mounted=!0,this.bodyOverlay.class="side-nav-filter",this.setupRefreshBlocker(),window.addEventListener("resize",this.recalculateHeight),window.onscroll=this.updateSideNavStick},updated(){this.updateSideNavStick()}});
